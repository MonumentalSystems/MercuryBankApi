# MercuryBankApi — LLM Integration Guide

> Strongly-typed C# client for the Mercury Bank API.
> NuGet: `MonumentalSystems.MercuryBankApi` | License: MIT | Target: .NET 10+

## Install

```bash
dotnet add package MonumentalSystems.MercuryBankApi
```

## Setup (Dependency Injection)

### Option 1: Bind from configuration

```csharp
// Program.cs
builder.Services.AddMercuryBankApi(builder.Configuration);
```

```json
// appsettings.json (store the token in user-secrets or environment variables)
{
  "Mercury": {
    "ApiToken": "your-mercury-api-token",
    "BaseUrl": "https://api.mercury.com/api/v1"
  }
}
```

### Option 2: Inline configuration

```csharp
builder.Services.AddMercuryBankApi(opts =>
{
    opts.ApiToken = "your-mercury-api-token";
    opts.BaseUrl = "https://api.mercury.com/api/v1"; // optional, this is the default
});
```

Both overloads register `IMercuryBankClient` (transient) and a named `HttpClient` with the Bearer token pre-configured.

## Usage

Inject `IMercuryBankClient` into any service or controller:

```csharp
public class AccountService(IMercuryBankClient mercury)
{
    public async Task<IReadOnlyList<Account>> GetAllAccounts()
    {
        return await mercury.GetAccountsAsync();
    }

    public async Task<Account> GetAccount(Guid id)
    {
        return await mercury.GetAccountAsync(id);
    }

    public async Task<IReadOnlyList<Transaction>> GetRecentTransactions()
    {
        var from = DateOnly.FromDateTime(DateTime.UtcNow.AddMonths(-1));
        var to = DateOnly.FromDateTime(DateTime.UtcNow);
        return await mercury.GetTransactionsAsync(from, to);
    }

    public async Task<IReadOnlyList<Transaction>> GetAccountTransactions(Guid accountId)
    {
        var from = DateOnly.FromDateTime(DateTime.UtcNow.AddMonths(-1));
        var to = DateOnly.FromDateTime(DateTime.UtcNow);
        return await mercury.GetAccountTransactionsAsync(accountId, from, to);
    }

    public async Task<Transaction> GetTransaction(Guid transactionId)
    {
        return await mercury.GetTransactionAsync(transactionId);
    }

    public async Task<OrganizationInfo> GetOrg()
    {
        return await mercury.GetOrganizationAsync();
    }

    public async Task<IReadOnlyList<ApiV1ArCustomerResponseData>> GetCustomers()
    {
        return await mercury.GetCustomersAsync();
    }
}
```

## Complete API Reference

All methods accept an optional `CancellationToken` as the last parameter.

### Accounts & Transactions

| Method | Signature | Returns | Description |
|--------|-----------|---------|-------------|
| `GetAccountsAsync` | `()` | `IReadOnlyList<Account>` | List all Mercury accounts |
| `GetAccountAsync` | `(Guid accountId)` | `Account` | Get a single account by ID |
| `GetAccountStatementsAsync` | `(Guid accountId)` | `IReadOnlyList<DepositoryAccountStatement>` | List statements for an account |
| `GetAccountCardsAsync` | `(Guid accountId)` | `IReadOnlyList<AccountCard>` | List cards for an account |
| `GetTransactionsAsync` | `(DateOnly from, DateOnly to)` | `IReadOnlyList<Transaction>` | List transactions across all accounts for a date range |
| `GetAccountTransactionsAsync` | `(Guid accountId, DateOnly from, DateOnly to)` | `IReadOnlyList<Transaction>` | List transactions for a specific account |
| `GetTransactionAsync` | `(Guid transactionId)` | `Transaction` | Get a single transaction by ID |

### Organization, Users & Categories

| Method | Signature | Returns | Description |
|--------|-----------|---------|-------------|
| `GetOrganizationAsync` | `()` | `OrganizationInfo` | Get organization details |
| `GetUsersAsync` | `()` | `IReadOnlyList<UserDetails>` | List all users in the organization |
| `GetUserAsync` | `(Guid userId)` | `UserDetails` | Get a single user by ID |
| `GetCategoriesAsync` | `()` | `IReadOnlyList<CategoryData>` | List all transaction categories |

### Events

| Method | Signature | Returns | Description |
|--------|-----------|---------|-------------|
| `GetEventsAsync` | `()` | `IReadOnlyList<ApiEventResponse>` | List all events |
| `GetEventAsync` | `(Guid eventId)` | `ApiEventResponse` | Get a single event by ID |

### Treasury

| Method | Signature | Returns | Description |
|--------|-----------|---------|-------------|
| `GetTreasuryAccountsAsync` | `()` | `IReadOnlyList<TreasuryAccount>` | List all treasury accounts |
| `GetTreasuryTransactionsAsync` | `(Guid treasuryId)` | `IReadOnlyList<TreasuryTxn>` | List transactions for a treasury account |

### SAFEs

| Method | Signature | Returns | Description |
|--------|-----------|---------|-------------|
| `GetSafeRequestsAsync` | `()` | `IReadOnlyList<APISafeRequest>` | List all SAFE requests |
| `GetSafeRequestAsync` | `(Guid safeRequestId)` | `APISafeRequest` | Get a single SAFE request by ID |

### Accounts Receivable — Customers

| Method | Signature | Returns | Description |
|--------|-----------|---------|-------------|
| `GetCustomersAsync` | `()` | `IReadOnlyList<ApiV1ArCustomerResponseData>` | List all AR customers |
| `GetCustomerAsync` | `(Guid customerId)` | `ApiV1ArCustomerResponseData` | Get a single AR customer |
| `CreateCustomerAsync` | `(ApiV1ArCustomerCreateRequest request)` | `ApiV1ArCustomerResponseData` | Create a new AR customer |
| `UpdateCustomerAsync` | `(Guid customerId, ApiV1ArCustomerUpdateRequest request)` | `ApiV1ArCustomerResponseData` | Update an AR customer |
| `DeleteCustomerAsync` | `(Guid customerId)` | `Task` | Delete an AR customer |

### Accounts Receivable — Invoices

| Method | Signature | Returns | Description |
|--------|-----------|---------|-------------|
| `GetInvoicesAsync` | `()` | `IReadOnlyList<ApiV1ArInvoicesData>` | List all AR invoices |
| `GetInvoiceAsync` | `(Guid invoiceId)` | `ApiV1ArInvoiceResponse` | Get a single AR invoice |
| `CreateInvoiceAsync` | `(ApiV1ArInvoiceCreateRequest request)` | `ApiV1ArInvoiceResponse` | Create a new AR invoice |
| `UpdateInvoiceAsync` | `(Guid invoiceId, ApiV1ArInvoiceUpdateRequest request)` | `ApiV1ArInvoiceResponse` | Update an AR invoice |
| `CancelInvoiceAsync` | `(Guid invoiceId)` | `Task` | Cancel an AR invoice |

### Send Money

| Method | Signature | Returns | Description |
|--------|-----------|---------|-------------|
| `RequestSendMoneyAsync` | `(Guid accountId, SendMoneyAPIRequest request)` | `SendMoneyApprovalRequestResponse` | Request approval to send money |
| `GetSendMoneyApprovalRequestAsync` | `(Guid requestId)` | `SendMoneyApprovalRequestResponse` | Get a send-money approval request |

## Key Types

### `MercuryBankOptions`

| Property | Type | Default | Description |
|----------|------|---------|-------------|
| `BaseUrl` | `string` | `https://api.mercury.com/api/v1` | Mercury API base URL |
| `ApiToken` | `string` | `""` | Bearer token from Mercury dashboard |

Configuration section name: `"Mercury"` (via `MercuryBankOptions.SectionName`)

### `Account` (from Mercury API)

Key properties: `Id` (Guid), `Name` (string), plus other Mercury account fields.

### `Transaction` (from Mercury API)

Key properties: `Id` (Guid), `Amount` (double), `CreatedAt` (string), `Status` (TransactionStatus), `CounterpartyName` (string), `Kind` (TransactionKind).

## Architecture

- **`IMercuryBankClient`** — Public high-level interface (what consumers use)
- **`MercuryBankClient`** — Sealed implementation wrapping the generated client
- **`IMercuryApiClient`** — Low-level NSwag-generated client (internal, not for direct use)
- **`ServiceCollectionExtensions`** — DI registration via `AddMercuryBankApi()`

## Requirements

- .NET 10 or later
- A Mercury Bank API token (obtain from Mercury dashboard)
- `Microsoft.Extensions.DependencyInjection` (included transitively)
